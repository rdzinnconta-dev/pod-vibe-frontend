<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Pod Vibe | Ofertas RelÃ¢mpago</title>
  <style>
    :root {
      --bg: #0a0015;
      --text: #e0e0ff;
      --card-bg: #1a0033;
      --accent: #00ff9d;
      --accent-dark: #00cc7a;
      --promo: #ff00aa;
      --glow: #00ffff;
    }
    body.light {
      --bg: #f0f4f8;
      --text: #1a1a2e;
      --card-bg: #ffffff;
      --accent: #00b86b;
      --accent-dark: #008f5b;
      --promo: #d6008c;
      --glow: #00ccff;
    }
    body {
      margin: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: var(--bg);
      color: var(--text);
      transition: background 0.4s, color 0.4s;
      min-height: 100vh;
    }
    header {
      background: linear-gradient(135deg, #6b00ff, #00d4ff);
      padding: 15px;
      text-align: center;
      position: relative;
      box-shadow: 0 0 20px var(--glow);
    }
    h1 { margin: 0; font-size: clamp(2em, 6vw, 3em); text-shadow: 0 0 15px var(--glow); }
    .aviso {
      background: #ff1744;
      color: white;
      padding: 8px;
      text-align: center;
      font-weight: bold;
      font-size: clamp(0.9em, 3vw, 1em);
    }
    #oferta-relampago {
      background: rgba(255, 0, 170, 0.3);
      border: 3px solid var(--promo);
      border-radius: 12px;
      margin: 15px 10px;
      padding: 15px;
      text-align: center;
      font-weight: bold;
      box-shadow: 0 0 20px var(--promo);
      animation: pulse 2s infinite;
    }
    @keyframes pulse {
      0% { box-shadow: 0 0 20px var(--promo); }
      50% { box-shadow: 0 0 40px var(--promo); }
      100% { box-shadow: 0 0 20px var(--promo); }
    }
    #timer {
      font-size: clamp(2.5em, 8vw, 3.5em);
      color: var(--promo);
      margin: 10px 0;
      text-shadow: 0 0 15px var(--promo);
      animation: flicker 1.5s infinite alternate;
    }
    @keyframes flicker {
      0% { opacity: 1; }
      100% { opacity: 0.8; }
    }
    #cart-icon {
      position: fixed;
      top: 15px;
      right: 15px;
      background: var(--accent);
      color: white;
      width: 60px;
      height: 60px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.8em;
      cursor: pointer;
      box-shadow: 0 0 20px var(--accent);
      z-index: 1000;
    }
    #cart-count {
      position: absolute;
      top: -8px;
      right: -8px;
      background: #ff1744;
      color: white;
      border-radius: 50%;
      width: 28px;
      height: 28px;
      font-size: 0.9em;
      display: none;
      align-items: center;
      justify-content: center;
      box-shadow: 0 0 10px #ff1744;
    }
    .produtos {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 20px;
      padding: 20px;
      max-width: 1600px;
      margin: 0 auto;
    }
    .card {
      background: var(--card-bg);
      border-radius: 16px;
      overflow: hidden;
      box-shadow: 0 6px 20px rgba(0,0,0,0.5);
      transition: transform 0.3s, box-shadow 0.3s;
    }
    .card:hover { transform: translateY(-10px); box-shadow: 0 0 30px var(--glow); }
    .card img {
      width: 100%;
      height: 220px;
      object-fit: contain;
      background: #111;
    }
    .card-body { padding: 15px; text-align: center; }
    .preco-antigo { text-decoration: line-through; color: #aaa; font-size: 1.1em; }
    .preco-novo {
      font-size: 1.7em;
      font-weight: bold;
      color: var(--promo);
      margin: 5px 0;
      text-shadow: 0 0 10px var(--promo);
    }
    .btn-comprar {
      background: linear-gradient(135deg, var(--accent), #00ffea);
      color: black;
      border: none;
      padding: 12px 24px;
      border-radius: 30px;
      cursor: pointer;
      font-weight: bold;
      font-size: 1em;
      transition: all 0.3s;
      box-shadow: 0 0 15px var(--accent);
      min-width: 160px;
    }
    .btn-comprar:hover { transform: scale(1.05); box-shadow: 0 0 30px var(--accent); }
    .btn-comprar:disabled { background: #666; cursor: not-allowed; box-shadow: none; }
    #theme-toggle {
      position: absolute;
      top: 15px;
      left: 15px;
      background: rgba(255,255,255,0.2);
      border: none;
      font-size: 1.6em;
      padding: 10px;
      border-radius: 50%;
      cursor: pointer;
      box-shadow: 0 0 15px var(--glow);
    }
    #carrinho-modal {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.85);
      align-items: center;
      justify-content: center;
      z-index: 999;
      padding: 10px;
    }
    .modal-content {
      background: var(--card-bg);
      width: 95%;
      max-width: 500px;
      border-radius: 20px;
      padding: 20px;
      position: relative;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 0 40px var(--glow);
    }
    .close { 
      position: absolute; 
      top: 10px; 
      right: 15px; 
      font-size: 2.2em; 
      cursor: pointer; 
      color: #aaa;
    }
    #itens-carrinho { list-style: none; padding: 0; margin: 0; }
    #itens-carrinho li {
      padding: 12px 0;
      border-bottom: 1px solid #444;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 1em;
      flex-wrap: wrap;
    }
    #total-carrinho { font-size: 1.6em; text-align: right; margin: 20px 0; font-weight: bold; color: var(--accent); }
    #btn-finalizar, #btn-pagar-real, #btn-continuar {
      width: 100%;
      padding: 14px;
      margin-top: 12px;
      border: none;
      border-radius: 30px;
      font-size: 1.2em;
      cursor: pointer;
      font-weight: bold;
      transition: all 0.3s;
    }
    #btn-finalizar { background: #000000; color: white; box-shadow: 0 0 15px #333; }
    #btn-pagar-real { background: #00b0ff; color: white; box-shadow: 0 0 15px #00b0ff; }
    #btn-continuar { background: var(--accent); color: black; box-shadow: 0 0 15px var(--accent); }
    #checkout-section { margin-top: 20px; display: none; }
    #pix-qr { margin: 20px 0; text-align: center; }
    #search-input {
      width: 100%;
      max-width: 600px;
      padding: 14px 20px;
      border-radius: 50px;
      border: none;
      font-size: 1.1em;
      background: var(--card-bg);
      color: var(--text);
      box-shadow: 0 0 15px var(--glow);
      margin: 15px auto;
      display: block;
    }
    footer {
      text-align: center;
      padding: 20px;
      background: #0d0015;
      margin-top: 40px;
      font-size: 0.9em;
      box-shadow: 0 0 20px var(--glow);
    }

    /* Responsividade */
    @media (max-width: 768px) {
      header { padding: 10px; }
      h1 { font-size: 2.2em; }
      .produtos { 
        grid-template-columns: 1fr; 
        padding: 15px; 
        gap: 15px; 
      }
      .card img { height: 200px; }
      .card-body { padding: 12px; }
      .preco-novo { font-size: 1.6em; }
      .btn-comprar { padding: 12px 20px; font-size: 1em; min-width: 140px; }
      #cart-icon { width: 55px; height: 55px; font-size: 1.6em; top: 10px; right: 10px; }
      #cart-count { width: 24px; height: 24px; font-size: 0.8em; }
      .modal-content { padding: 15px; width: 98%; }
      #search-input { font-size: 1em; padding: 12px 16px; }
      #oferta-relampago { margin: 10px; padding: 12px; }
      #timer { font-size: 2.5em; }
    }

    @media (max-width: 480px) {
      h1 { font-size: 1.8em; }
      .btn-comprar { width: 100%; margin-top: 10px; }
      #itens-carrinho li { flex-direction: column; text-align: center; gap: 8px; }
    }
  </style>
</head>
<body class="dark">
  <!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Pod Vibe | Ofertas RelÃ¢mpago</title>
  <style>
    :root {
      --bg: #0a0015;
      --text: #e0e0ff;
      --card-bg: #1a0033;
      --accent: #00ff9d;
      --accent-dark: #00cc7a;
      --promo: #ff00aa;
      --glow: #00ffff;
    }
    body.light {
      --bg: #f0f4f8;
      --text: #1a1a2e;
      --card-bg: #ffffff;
      --accent: #00b86b;
      --accent-dark: #008f5b;
      --promo: #d6008c;
      --glow: #00ccff;
    }
    body {
      margin: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: var(--bg);
      color: var(--text);
      transition: background 0.4s, color 0.4s;
    }
    header {
      background: linear-gradient(135deg, #2c0270, #9900ff);
      padding: 20px;
      text-align: center;
      position: relative;
      box-shadow: 0 0 20px var(--glow);
    }
    h1 { margin: 0; font-size: 3em; text-shadow: 0 0 15px var(--glow); }
    .aviso {
      background: #ff1744;
      color: white;
      padding: 10px;
      text-align: center;
      font-weight: bold;
    }
    #oferta-relampago {
      background: rgba(255, 0, 170, 0.3);
      border: 3px solid var(--promo);
      border-radius: 12px;
      margin: 20px auto;
      max-width: 900px;
      padding: 20px;
      text-align: center;
      font-weight: bold;
      box-shadow: 0 0 20px var(--promo);
      animation: pulse 2s infinite;
    }
    @keyframes pulse {
      0% { box-shadow: 0 0 20px var(--promo); }
      50% { box-shadow: 0 0 40px var(--promo); }
      100% { box-shadow: 0 0 20px var(--promo); }
    }
    #timer {
      font-size: 3.5em;
      color: var(--promo);
      margin: 10px 0;
      text-shadow: 0 0 15px var(--promo);
      animation: flicker 1.5s infinite alternate;
    }
    @keyframes flicker {
      0% { opacity: 1; }
      100% { opacity: 0.8; }
    }
    #cart-icon {
      position: fixed;
      top: 20px;
      right: 20px;
      background: var(--accent);
      color: white;
      width: 70px;
      height: 70px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2em;
      cursor: pointer;
      box-shadow: 0 0 20px var(--accent);
      z-index: 1000;
    }
    #cart-count {
      position: absolute;
      top: -10px;
      right: -10px;
      background: #ff1744;
      color: white;
      border-radius: 50%;
      width: 32px;
      height: 32px;
      font-size: 1em;
      display: none;
      align-items: center;
      justify-content: center;
      box-shadow: 0 0 10px #ff1744;
    }
    .produtos {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 25px;
      padding: 40px;
      max-width: 1600px;
      margin: 0 auto;
    }
    .card {
      background: var(--card-bg);
      border-radius: 16px;
      overflow: hidden;
      box-shadow: 0 6px 20px rgba(0,0,0,0.5);
      transition: transform 0.3s, box-shadow 0.3s;
      position: relative;
    }
    .card:hover { transform: translateY(-10px); box-shadow: 0 0 30px var(--glow); }
    .card img {
      width: 100%;
      height: 240px;
      object-fit: contain;
      background: #111;
    }
    .card-body { padding: 20px; text-align: center; }
    .preco-antigo {
      text-decoration: line-through;
      color: #aaa;
      font-size: 1.3em;
    }
    .preco-novo {
      font-size: 2em;
      font-weight: bold;
      color: var(--promo);
      margin: 8px 0;
      text-shadow: 0 0 10px var(--promo);
    }
    .btn-comprar {
      background: linear-gradient(135deg, var(--accent), #00ffea);
      color: black;
      border: none;
      padding: 14px 28px;
      border-radius: 30px;
      cursor: pointer;
      font-weight: bold;
      font-size: 1.1em;
      transition: all 0.3s;
      box-shadow: 0 0 15px var(--accent);
    }
    .btn-comprar:hover { transform: scale(1.05); box-shadow: 0 0 30px var(--accent); }
    .btn-comprar:disabled {
      background: #666;
      cursor: not-allowed;
      box-shadow: none;
    }
    #theme-toggle {
      position: absolute;
      top: 20px;
      left: 20px;
      background: rgba(255,255,255,0.2);
      border: none;
      font-size: 1.8em;
      padding: 12px;
      border-radius: 50%;
      cursor: pointer;
      box-shadow: 0 0 15px var(--glow);
    }
    #carrinho-modal {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.85);
      align-items: center;
      justify-content: center;
      z-index: 999;
    }
    .modal-content {
      background: var(--card-bg);
      width: 90%;
      max-width: 550px;
      border-radius: 20px;
      padding: 30px;
      position: relative;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 0 40px var(--glow);
    }
    .close { 
      position: absolute; 
      top: 15px; 
      right: 25px; 
      font-size: 2.5em; 
      cursor: pointer; 
      color: #aaa;
    }
    #itens-carrinho { list-style: none; padding: 0; }
    #itens-carrinho li {
      padding: 15px 0;
      border-bottom: 1px solid #444;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 1.1em;
    }
    #total-carrinho { font-size: 1.8em; text-align: right; margin: 25px 0; font-weight: bold; color: var(--accent); }
    #btn-finalizar, #btn-pagar-real, #btn-continuar {
      width: 100%;
      padding: 16px;
      margin-top: 15px;
      border: none;
      border-radius: 30px;
      font-size: 1.3em;
      cursor: pointer;
      font-weight: bold;
      transition: all 0.3s;
    }
    #btn-finalizar { background: #00c853; color: rgb(0, 0, 0); box-shadow: 0 0 15px #00c853; }
    #btn-pagar-real { background: #00b0ff; color: white; box-shadow: 0 0 15px #00b0ff; }
    #btn-continuar { background: var(--accent); color: black; box-shadow: 0 0 15px var(--accent); }
    #checkout-section { margin-top: 25px; display: none; }
    #pix-qr { margin: 25px 0; text-align: center; }
    #search-input {
      width: 100%;
      max-width: 600px;
      padding: 16px 24px;
      border-radius: 50px;
      border: none;
      font-size: 1.2em;
      background: var(--card-bg);
      color: var(--text);
      box-shadow: 0 0 15px var(--glow);
      margin: 20px auto;
      display: block;
    }
    footer {
      text-align: center;
      padding: 25px;
      background: #0d0015;
      margin-top: 50px;
      font-size: 1em;
      box-shadow: 0 0 20px var(--glow);
    }
  </style>
</head>
<body class="dark">

<header>
  <button id="theme-toggle" aria-label="Alternar tema">ðŸŒ™</button>
  <h1>Pod Vibe</h1>
  <p>Ofertas RelÃ¢mpago | DescartÃ¡veis, Pods e Juices</p>

  <div style="margin: 20px auto; max-width: 600px; width: 90%;">
    <input type="text" id="search-input" placeholder="Buscar por sabor, marca, tipo... (ex: morango, elfbar, xros)">
  </div>
</header>

<div id="oferta-relampago">
  <h2 style="color: var(--promo); margin: 0;">Oferta RelÃ¢mpago - Acaba em:</h2>
  <div id="timer">10:00</div>
  <p style="color: #aaa; margin: 5px 0;">Corre que tÃ¡ voando!</p>
</div>

<div class="aviso">
  <strong>Melhores PreÃ§os sÃ³ aqui</strong> â€” Pagamentos via PIX QR Code.
</div>

<div id="cart-icon" onclick="abrirCarrinho()">
  <span>ðŸ›’</span>
  <span id="cart-count">0</span>
</div>

<section class="produtos" id="lista-produtos">
  <div id="no-results" style="grid-column:1/-1; text-align:center; padding:60px; display:none;">
    Nenhum produto encontrado ðŸ˜•
  </div>
</section>

<!-- MODAL CARRINHO (apenas essa parte mudou) -->
<div id="carrinho-modal">
  <div class="modal-content">
    <span class="close" onclick="fecharCarrinho()">&times;</span>
    <h2>Seu Carrinho</h2>
    <ul id="itens-carrinho"></ul>
    <div id="total-carrinho">Total: R$ 0,00</div>
    <button id="btn-finalizar">Finalizar Compra</button>
    <button id="btn-continuar">Continuar Comprando</button>

    <div id="checkout-section">
      <h3>Pagamento via PIX</h3>
      <div id="pix-qr"></div>
      <button id="btn-pagar-real">Gerar PIX (QR Code)</button>
      <p style="font-size:0.85em; color:#aaa; margin-top:15px; text-align:center;">
        ApÃ³s o pagamento, envie o comprovante via WhatsApp para confirmaÃ§Ã£o rÃ¡pida.
      </p>
    </div>
  </div>
</div>

<footer>
  <p>Pod Vibe Â© 2026 | Apenas maiores de 18 anos | Consulte frete</p>
</footer>

<script>
// === PRODUTOS EM OFERTA RELÃ‚MPAGO - COMPLETOS E POPULARES ===
const produtos = [
  { id: 1, nome: 'Elf Bar BC5000 - Morango Watermelon Ice', precoOriginal: 8990, desconto: 0.35, img: 'https://cdn11.bigcommerce.com/s-je1vzfcvbs/images/stencil/1280x1280/products/754/1803/ELF-BAR-BC5000-WATERMELON-ICE-DISPOSABLE-POD-DEVICE__54040.1673647318.jpg?c=2', desc: '5000 puffs, morango melancia gelado, hit insano.' },
  { id: 2, nome: 'Lost Mary MO5000 - Blueberry Ice', precoOriginal: 9490, desconto: 0.30, img: 'https://media.vaping360.com/images/lost-mary-mo5000-02-593b583120.webp?imageType=Standard', desc: '5000 puffs, blueberry gelado, design premium.' },
  { id: 3, nome: 'Vaporesso XROS 4 Mini Kit', precoOriginal: 16990, desconto: 0.25, img: 'https://vapingvibe.com/wp-content/uploads/2024/05/vaporesso-xros4-xros4mini-01.jpg', desc: 'Pod recarregÃ¡vel, bateria 1000mAh, cores neon.' },
  { id: 4, nome: 'Juice Nic Salt 30ml - Mango Ice', precoOriginal: 4990, desconto: 0.40, img: 'https://vapejuice.com/cdn/shop/products/MANGOBYSKWEZEDSALTS30ML.jpg?v=1714431657', desc: '50mg nic salt, manga gelada, throat hit perfeito.' },
  { id: 5, nome: 'Geek Bar Pulse X 25.000 Puffs', precoOriginal: 12990, desconto: 0.30, img: 'https://vapewh.com/cdn/shop/files/Geek_Bar_Pulse_X_Group_c3132038-a467-4393-92d6-c6b48e9f351e.jpg?v=1728757190&width=960', desc: '25.000 puffs, tela digital, recarregÃ¡vel, sabores intensos.' },
  { id: 6, nome: 'Coil ReposiÃ§Ã£o XROS Mesh 0.6ohm (5un)', precoOriginal: 3990, desconto: 0.35, img: 'https://cdn.awsli.com.br/2500x2500/2455/2455278/produto/218666413/coil_xros_0_6-uv91qtahxs.png', desc: 'Mesh para vapor denso, compatÃ­vel XROS series.' },
  { id: 7, nome: 'Ignite V80 8000 Puffs - Strawberry Kiwi', precoOriginal: 7990, desconto: 0.25, img: 'https://mundovape.net/wp-content/uploads/2024/03/Strawberry-Kiwi-8000.jpg', desc: '8000 puffs, morango kiwi, sabor explosivo.' },
  { id: 8, nome: 'Juice Salt 30ml - Grape Ice', precoOriginal: 4990, desconto: 0.40, img: 'https://vapesocietysupplies.com/wp-content/uploads/2023/09/Mango-ICE-POP-SALTS-30ml-2.jpg', desc: 'Uva gelada, 35mg nic salt, favorito da galera.' },
  { id: 9, nome: 'Pod System Caliburn G3 Pro', precoOriginal: 18990, desconto: 0.20, img: 'https://myvapereview.com/wp-content/uploads/2024/06/20240613144118-667x500.jpg', desc: 'Tela OLED, bateria 1250mAh, cores RGB, top do ano.' }
];

// Calcula preÃ§o com desconto
produtos.forEach(p => {
  p.preco = Math.round(p.precoOriginal * (1 - p.desconto));
});

// Elementos DOM
const listaProdutos = document.getElementById('lista-produtos');
const searchInput = document.getElementById('search-input');
const noResults = document.getElementById('no-results');
const cartCountEl = document.getElementById('cart-count');
const timerEl = document.getElementById('timer');
const ofertaEl = document.getElementById('oferta-relampago');

// Timer de 10 minutos
let tempoRestante = 600;
let timerInterval;

function atualizarTimer() {
  const minutos = Math.floor(tempoRestante / 60);
  const segundos = tempoRestante % 60;
  timerEl.textContent = `${minutos.toString().padStart(2, '0')}:${segundos.toString().padStart(2, '0')}`;

  if (tempoRestante <= 0) {
    clearInterval(timerInterval);
    timerEl.textContent = '00:00';
    ofertaEl.innerHTML = '<h2 style="color: var(--promo);">Oferta finalizada!</h2><p>A prÃ³xima vem aÃ­...</p>';
    document.querySelectorAll('.btn-comprar').forEach(btn => btn.disabled = true);
  }
  tempoRestante--;
}

timerInterval = setInterval(atualizarTimer, 1000);
atualizarTimer();

// Normalizar texto
function normalizar(texto) {
  return texto.toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g, '');
}

// Criar card
function criarCard(prod) {
  return `
    <div class="card">
      <img src="${prod.img}" alt="${prod.nome}" loading="lazy">
      <div class="card-body">
        <h3>${prod.nome}</h3>
        <p>${prod.desc}</p>
        <div class="preco-antigo">R$ ${(prod.precoOriginal / 100).toFixed(2).replace('.', ',')}</div>
        <div class="preco-novo">R$ ${(prod.preco / 100).toFixed(2).replace('.', ',')} <small>(-${Math.round(prod.desconto * 100)}%)</small></div>
        <button class="btn-comprar" onclick="adicionarCarrinho(${prod.id})">Adicionar ao Carrinho</button>
      </div>
    </div>
  `;
}

// Renderizar
function renderizarProdutos(filtrados) {
  listaProdutos.innerHTML = '<div id="no-results" style="grid-column:1/-1;text-align:center;padding:60px;display:none;">Nenhum produto encontrado ðŸ˜•</div>';
  const noRes = document.getElementById('no-results');
  noRes.style.display = filtrados.length ? 'none' : 'block';
  filtrados.forEach(p => listaProdutos.insertAdjacentHTML('beforeend', criarCard(p)));
}

// Inicial
renderizarProdutos(produtos);

// Busca
let timeoutBusca = null;
searchInput.addEventListener('input', () => {
  clearTimeout(timeoutBusca);
  timeoutBusca = setTimeout(() => {
    const termo = normalizar(searchInput.value.trim());
    if (!termo) return renderizarProdutos(produtos);
    const filtrados = produtos.filter(p =>
      normalizar(p.nome).includes(termo) || normalizar(p.desc).includes(termo)
    );
    renderizarProdutos(filtrados);
  }, 300);
});

// Tema
const themeToggle = document.getElementById('theme-toggle');
themeToggle.onclick = () => {
  document.body.classList.toggle('light');
  themeToggle.textContent = document.body.classList.contains('light') ? 'ðŸŒ™' : 'â˜€ï¸';
};

// Carrinho
let carrinho = [];
const modal = document.getElementById('carrinho-modal');
const itensLista = document.getElementById('itens-carrinho');
const totalEl = document.getElementById('total-carrinho');
const btnFinalizar = document.getElementById('btn-finalizar');
const checkoutSection = document.getElementById('checkout-section');
const btnPagarReal = document.getElementById('btn-pagar-real');
const btnContinuar = document.getElementById('btn-continuar');

function abrirCarrinho() { modal.style.display = 'flex'; atualizarCarrinho(); }
function fecharCarrinho() { modal.style.display = 'none'; checkoutSection.style.display = 'none'; }
modal.onclick = e => { if (e.target === modal) fecharCarrinho(); };

btnContinuar.onclick = () => {
  fecharCarrinho();
};

function adicionarCarrinho(id) {
  if (tempoRestante <= 0) return alert('Oferta finalizada!');
  const prod = produtos.find(p => p.id === id);
  const item = carrinho.find(i => i.id === id);
  if (item) item.qtd++;
  else carrinho.push({ ...prod, qtd: 1 });
  atualizarCarrinho();
  abrirCarrinho();
}

function atualizarCarrinho() {
  itensLista.innerHTML = '';
  let total = 0, qtdTotal = 0;
  carrinho.forEach((item, idx) => {
    const sub = item.preco * item.qtd;
    total += sub;
    qtdTotal += item.qtd;
    itensLista.innerHTML += `
      <li>
        <button style="background:#00ff9d;color:black;border:none;padding:6px 10px;border-radius:50%;cursor:pointer;font-weight:bold;margin-right:8px;" onclick="aumentarQtd(${idx})">+</button>
        ${item.nome} Ã—${item.qtd}
        <span>R$ ${(sub/100).toFixed(2).replace('.', ',')}</span>
        <button style="background:#ff1744;color:white;border:none;padding:4px 10px;border-radius:4px;cursor:pointer;margin-left:10px;" onclick="removerItem(${idx})">â€“</button>
      </li>`;
  });
  totalEl.textContent = `Total: R$ ${(total/100).toFixed(2).replace('.', ',')}`;
  cartCountEl.textContent = qtdTotal;
  cartCountEl.style.display = qtdTotal > 0 ? 'flex' : 'none';
}

// Nova funÃ§Ã£o para aumentar quantidade
function aumentarQtd(idx) {
  carrinho[idx].qtd++;
  atualizarCarrinho();
}

function removerItem(idx) {
  carrinho[idx].qtd--;
  if (carrinho[idx].qtd <= 0) carrinho.splice(idx, 1);
  atualizarCarrinho();
}

btnFinalizar.onclick = () => {
  if (!carrinho.length) return alert('Carrinho vazio!');
  checkoutSection.style.display = 'block';
  document.getElementById('pix-qr').innerHTML = '';
  btnPagarReal.style.display = 'block';
};

// PIX
btnPagarReal.onclick = async () => {
  if (carrinho.length === 0) return alert('Carrinho vazio!');
  if (tempoRestante <= 0) return alert('Oferta finalizada!');

  const items = carrinho.map(item => ({
    title: item.nome,
    unit_price: item.preco,
    quantity: item.qtd
  }));

  try {
    btnPagarReal.disabled = true;
    btnPagarReal.textContent = 'Gerando PIX...';

    const response = await fetch('https://pod-vibe-frontend.onrender.com/', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ items })
    });

    if (!response.ok) {
      const errText = await response.text();
      throw new Error(`Erro: ${response.status} - ${errText}`);
    }

    const data = await response.json();

    if (!data.success) throw new Error(data.error || 'Erro desconhecido');

    document.getElementById('pix-qr').innerHTML = `
      <p style="font-weight:bold;color:#00ff9d;font-size:1.3em;">
        Pague exatamente R$ ${data.valor.toFixed(2).replace('.', ',')}
      </p>
      <img src="${data.qrCodeBase64}" alt="QR Code PIX" style="width:220px;height:220px;margin:20px auto;display:block;border-radius:12px;" />
      <p style="font-size:0.9em;color:#aaa;">Ou copie e cole:</p>
      <input type="text" value="${data.payload}" readonly style="width:100%;padding:12px;text-align:center;background:#222;color:#0f0;border:1px solid #444;border-radius:8px;" onclick="this.select()" />
    `;

    btnPagarReal.style.display = 'none';

  } catch (err) {
    alert('Erro ao gerar PIX: ' + err.message);
    console.error(err);
  } finally {
    btnPagarReal.disabled = false;
    btnPagarReal.textContent = 'Gerar PIX (QR Code)';
  }
};

atualizarCarrinho();
</script>
</body>
</html>